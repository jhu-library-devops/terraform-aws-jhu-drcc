# =============================================================================
# Terraform Backend Configuration (S3 + DynamoDB)
# =============================================================================
#
# This file configures remote state storage using S3 with DynamoDB state locking.
# Remote state is essential for team collaboration and production deployments.
#
# SETUP INSTRUCTIONS:
#
# 1. Copy this file to backend.tf:
#      cp backend.tf.example backend.tf
#
# 2. Create the S3 bucket for state storage:
#      aws s3api create-bucket \
#        --bucket <your-org>-drcc-terraform-state \
#        --region us-east-1
#
#      aws s3api put-bucket-versioning \
#        --bucket <your-org>-drcc-terraform-state \
#        --versioning-configuration Status=Enabled
#
#      aws s3api put-bucket-encryption \
#        --bucket <your-org>-drcc-terraform-state \
#        --server-side-encryption-configuration \
#          '{"Rules":[{"ApplyServerSideEncryptionByDefault":{"SSEAlgorithm":"aws:kms"}}]}'
#
#      aws s3api put-public-access-block \
#        --bucket <your-org>-drcc-terraform-state \
#        --public-access-block-configuration \
#          BlockPublicAcls=true,IgnorePublicAcls=true,BlockPublicPolicy=true,RestrictPublicBuckets=true
#
# 3. Create the DynamoDB table for state locking:
#      aws dynamodb create-table \
#        --table-name drcc-terraform-locks \
#        --attribute-definitions AttributeName=LockID,AttributeType=S \
#        --key-schema AttributeName=LockID,KeyType=HASH \
#        --billing-mode PAY_PER_REQUEST \
#        --region us-east-1
#
# 4. Update the bucket, key, and dynamodb_table values below, then run:
#      terraform init
#
# =============================================================================

terraform {
  backend "s3" {
    # S3 bucket for storing Terraform state (must already exist)
    bucket = "<your-org>-drcc-terraform-state"

    # Path within the bucket â€” use a unique key per environment
    key = "drcc/prod/terraform.tfstate"

    region = "us-east-1"

    # DynamoDB table for state locking (must already exist)
    dynamodb_table = "drcc-terraform-locks"

    # Encrypt state at rest
    encrypt = true
  }
}
