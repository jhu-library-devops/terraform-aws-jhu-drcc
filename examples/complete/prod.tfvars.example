# =============================================================================
# Production Configuration - Complete DSpace Deployment
# =============================================================================
# This file shows all configurable values for a production deployment.
# Copy to prod.tfvars and update values for your institution.
#
# Legend:
#   [REQUIRED]  - You must set this value
#   [OPTIONAL]  - Has a sensible default; override only if needed
# =============================================================================

# --- Identity (REQUIRED) ---
# These values are used in resource naming: {organization}-{project_name}-{environment}
organization  = "jhu"                        # [REQUIRED] Your institution's short name
project_name  = "dspace"                     # [OPTIONAL] Project identifier (default: "dspace")
environment   = "prod"                       # [REQUIRED] Environment name (e.g., prod, stage, dev)
aws_region    = "us-east-1"                  # [OPTIONAL] AWS region (default: "us-east-1")
public_domain = "dspace.library.jhu.edu"     # [REQUIRED] Public domain for the DSpace application

# --- VPC Configuration (REQUIRED) ---
# Plan CIDR blocks to avoid conflicts with existing networks or VPN ranges.
# Each subnet list must have at least 2 entries for multi-AZ high availability.
vpc_cidr             = "10.0.0.0/16"
public_subnet_cidrs  = ["10.0.1.0/24", "10.0.2.0/24", "10.0.3.0/24"]
private_subnet_cidrs = ["10.0.11.0/24", "10.0.12.0/24", "10.0.13.0/24"]

# --- Database Configuration (REQUIRED) ---
# See https://aws.amazon.com/rds/instance-types/ for sizing guidance.
# Production recommendation: db.r5.xlarge or larger with Multi-AZ enabled.
db_instance_class    = "db.r5.xlarge"        # [REQUIRED] RDS instance type
db_allocated_storage = 500                   # [REQUIRED] Storage in GB
db_name              = "dspace"              # [OPTIONAL] Database name (default: "dspace")
db_username          = "dspaceuser"          # [OPTIONAL] Master username (default: "dspaceuser")
db_multi_az          = true                  # [OPTIONAL] Enable Multi-AZ for HA (default: false)

# --- Solr Configuration (REQUIRED) ---
# Sizing guide:
#   Development:  1 node,  no Zookeeper
#   Small prod:   3 nodes, 3 Zookeeper
#   Medium prod:  5 nodes, 3 Zookeeper
#   Large prod:   7+ nodes, 5 Zookeeper
solr_node_count      = 5                     # [REQUIRED] Number of Solr nodes (use odd numbers)
deploy_zookeeper     = true                  # [REQUIRED] Deploy Zookeeper ensemble
zookeeper_task_count = 3                     # [REQUIRED] Zookeeper nodes (3 or 5 for quorum)
solr_cpu             = "4096"                # [REQUIRED] CPU units per Solr task (1024 = 1 vCPU)
solr_memory          = "8192"                # [REQUIRED] Memory in MiB per Solr task

# --- DSpace Application Configuration (REQUIRED) ---
# Minimum 2 tasks per service recommended for production high availability.
dspace_angular_task_count = 4                # [REQUIRED] Number of Angular UI tasks
dspace_api_task_count     = 4                # [REQUIRED] Number of REST API tasks

# --- DSpace Storage (REQUIRED) ---
dspace_asset_store_bucket_name = "my-org-dspace-assets"  # [REQUIRED] S3 bucket name for digital assets

# --- Monitoring (REQUIRED) ---
alarm_notification_email = "ops@example.edu" # [REQUIRED] Email for CloudWatch alarm notifications

# --- Initialization (OPTIONAL) ---
# Set enable_init_tasks to true on first deployment to run database migration and Solr setup.
# After initialization completes, set back to false.
enable_init_tasks = false                    # [OPTIONAL] Enable init Lambda (default: false)
dspace_api_image  = "dspace/dspace:7.6"      # [OPTIONAL] DSpace API image for init tasks

# --- External Task Definitions (OPTIONAL) ---
# Uncomment to use task definitions managed outside Terraform (e.g., via CI/CD pipeline).
# When set, the module uses these ARNs instead of creating its own task definitions.
# dspace_angular_task_def_arn = "arn:aws:ecs:us-east-1:123456789012:task-definition/dspace-angular:latest"
# dspace_api_task_def_arn     = "arn:aws:ecs:us-east-1:123456789012:task-definition/dspace-api:latest"
# dspace_jobs_task_def_arn    = "arn:aws:ecs:us-east-1:123456789012:task-definition/dspace-jobs:latest"
