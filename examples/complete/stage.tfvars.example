# =============================================================================
# Staging Configuration - Complete DSpace Deployment
# =============================================================================
# Staging environment with reduced resources for testing and validation.
# Copy to stage.tfvars and update values for your institution.
#
# Legend:
#   [REQUIRED]  - You must set this value
#   [OPTIONAL]  - Has a sensible default; override only if needed
# =============================================================================

# --- Identity (REQUIRED) ---
organization  = "jhu"                        # [REQUIRED] Your institution's short name
project_name  = "dspace"                     # [OPTIONAL] Project identifier
environment   = "stage"                      # [REQUIRED] Environment name
aws_region    = "us-east-1"                  # [OPTIONAL] AWS region
public_domain = "dspace-stage.example.edu"   # [REQUIRED] Public domain for staging

# --- VPC Configuration (REQUIRED) ---
# Use a different CIDR range than production to allow VPC peering if needed.
vpc_cidr             = "10.1.0.0/16"
public_subnet_cidrs  = ["10.1.1.0/24", "10.1.2.0/24", "10.1.3.0/24"]
private_subnet_cidrs = ["10.1.11.0/24", "10.1.12.0/24", "10.1.13.0/24"]

# --- Database Configuration (REQUIRED) ---
# Smaller instance for staging; Multi-AZ disabled to reduce cost.
db_instance_class    = "db.t3.medium"        # [REQUIRED] Smaller instance for staging
db_allocated_storage = 100                   # [REQUIRED] Storage in GB
db_name              = "dspace"              # [OPTIONAL] Database name
db_username          = "dspaceuser"          # [OPTIONAL] Master username
db_multi_az          = false                 # [OPTIONAL] Disable Multi-AZ to save cost

# --- Solr Configuration (REQUIRED) ---
# 3-node cluster is sufficient for staging validation.
solr_node_count      = 3                     # [REQUIRED] Fewer nodes than production
deploy_zookeeper     = true                  # [REQUIRED] Deploy Zookeeper ensemble
zookeeper_task_count = 3                     # [REQUIRED] Zookeeper nodes
solr_cpu             = "2048"                # [REQUIRED] CPU units per Solr task
solr_memory          = "4096"                # [REQUIRED] Memory in MiB per Solr task

# --- DSpace Application Configuration (REQUIRED) ---
dspace_angular_task_count = 2                # [REQUIRED] Fewer tasks than production
dspace_api_task_count     = 2                # [REQUIRED] Fewer tasks than production

# --- DSpace Storage (REQUIRED) ---
dspace_asset_store_bucket_name = "my-org-dspace-assets-stage"  # [REQUIRED] S3 bucket name

# --- Monitoring (REQUIRED) ---
alarm_notification_email = "ops@example.edu" # [REQUIRED] Email for alarm notifications

# --- Task Definition Management (REQUIRED) ---
# Set to false to have Terraform manage task definitions (recommended).
# Set to true to use externally-managed task definitions (e.g., from CI/CD).
use_external_task_definitions = false        # [REQUIRED] Use Terraform-managed task definitions

# --- Container Images (REQUIRED when use_external_task_definitions = false) ---
# Docker image URIs for DSpace containers. Update with your registry and tags.
dspace_api_image     = "ghcr.io/dspace/dspace:dspace-7.6.1"      # [REQUIRED] DSpace REST API image
dspace_angular_image = "ghcr.io/dspace/dspace-angular:dspace-7.6.1"  # [REQUIRED] DSpace Angular UI image
dspace_jobs_image    = "ghcr.io/dspace/dspace:dspace-7.6.1"      # [REQUIRED] DSpace Jobs image

# Solr and Zookeeper images
solr_image      = "ghcr.io/jhu-sheridan-libraries/idc-isle-solr:latest"  # [REQUIRED] Solr image
zookeeper_image = "zookeeper:3.9.3"                              # [REQUIRED] Zookeeper image

# --- Container Resource Allocation (OPTIONAL) ---
# CPU and memory settings for each service. Defaults shown are recommended for staging.
# CPU units: 1024 = 1 vCPU. Memory in MiB.
dspace_api_cpu       = 2048                  # [OPTIONAL] DSpace API CPU (default: 2048)
dspace_api_memory    = 4096                  # [OPTIONAL] DSpace API memory (default: 4096)
dspace_angular_cpu   = 2048                  # [OPTIONAL] Angular UI CPU (default: 2048)
dspace_angular_memory = 4096                 # [OPTIONAL] Angular UI memory (default: 4096)
dspace_jobs_cpu      = 4096                  # [OPTIONAL] Jobs service CPU (default: 4096)
dspace_jobs_memory   = 8192                  # [OPTIONAL] Jobs service memory (default: 8192)
solr_cpu             = 2048                  # [OPTIONAL] Solr CPU per node (default: 2048)
solr_memory          = 16384                 # [OPTIONAL] Solr memory per node (default: 16384)

# --- SSM Parameter ARNs for Secrets (REQUIRED when use_external_task_definitions = false) ---
# ARNs of AWS Systems Manager Parameter Store parameters containing sensitive configuration.
# Replace ACCOUNT_ID with your AWS account ID.

# DSpace API and Jobs secrets
dspace_server_url_ssm_arn     = "arn:aws:ssm:us-east-1:ACCOUNT_ID:parameter/dspace/stage/server/url"
dspace_server_ssr_url_ssm_arn = "arn:aws:ssm:us-east-1:ACCOUNT_ID:parameter/dspace/stage/server/ssr-url"
dspace_ui_url_ssm_arn         = "arn:aws:ssm:us-east-1:ACCOUNT_ID:parameter/dspace/stage/ui/url"
dspace_db_url_ssm_arn         = "arn:aws:ssm:us-east-1:ACCOUNT_ID:parameter/dspace/stage/db/url"
dspace_db_username_ssm_arn    = "arn:aws:ssm:us-east-1:ACCOUNT_ID:parameter/dspace/stage/db/username"
dspace_db_password_ssm_arn    = "arn:aws:ssm:us-east-1:ACCOUNT_ID:parameter/dspace/stage/db/password"
dspace_solr_url_ssm_arn       = "arn:aws:ssm:us-east-1:ACCOUNT_ID:parameter/dspace/stage/solr/url"

# Mail server configuration
dspace_mail_server_ssm_arn   = "arn:aws:ssm:us-east-1:ACCOUNT_ID:parameter/dspace/stage/mail/server"
dspace_mail_port_ssm_arn     = "arn:aws:ssm:us-east-1:ACCOUNT_ID:parameter/dspace/stage/mail/port"
dspace_mail_username_ssm_arn = "arn:aws:ssm:us-east-1:ACCOUNT_ID:parameter/dspace/stage/mail/username"
dspace_mail_password_ssm_arn = "arn:aws:ssm:us-east-1:ACCOUNT_ID:parameter/dspace/stage/mail/password"
dspace_mail_disabled_ssm_arn = "arn:aws:ssm:us-east-1:ACCOUNT_ID:parameter/dspace/stage/mail/disabled"

# JVM options for DSpace services
dspace_api_java_opts_ssm_arn  = "arn:aws:ssm:us-east-1:ACCOUNT_ID:parameter/dspace/stage/api/java-opts"
dspace_jobs_java_opts_ssm_arn = "arn:aws:ssm:us-east-1:ACCOUNT_ID:parameter/dspace/stage/jobs/java-opts"

# Google Analytics configuration (optional)
dspace_google_analytics_key_ssm_arn        = "arn:aws:ssm:us-east-1:ACCOUNT_ID:parameter/dspace/stage/analytics/key"
dspace_google_analytics_cron_ssm_arn       = "arn:aws:ssm:us-east-1:ACCOUNT_ID:parameter/dspace/stage/analytics/cron"
dspace_google_analytics_api_secret_ssm_arn = "arn:aws:ssm:us-east-1:ACCOUNT_ID:parameter/dspace/stage/analytics/api-secret"

# DSpace Angular secrets
dspace_rest_host_ssm_arn       = "arn:aws:ssm:us-east-1:ACCOUNT_ID:parameter/dspace/stage/angular/rest-host"
dspace_rest_ssr_url_ssm_arn    = "arn:aws:ssm:us-east-1:ACCOUNT_ID:parameter/dspace/stage/angular/rest-ssr-url"
dspace_angular_node_opts_ssm_arn = "arn:aws:ssm:us-east-1:ACCOUNT_ID:parameter/dspace/stage/angular/node-opts"

# Solr and Zookeeper secrets

# --- CloudWatch Log Groups (OPTIONAL) ---
# Log group names for container logs. If not specified, defaults will be used.
dspace_api_log_group_name     = "/ecs/jhu-stage-dspace-api"
dspace_angular_log_group_name = "/ecs/jhu-stage-dspace-angular"
dspace_jobs_log_group_name    = "/ecs/jhu-stage-dspace-jobs"

# --- External Task Definitions (OPTIONAL) ---
# Only needed when use_external_task_definitions = true.
# Uncomment and set these if you manage task definitions outside Terraform.
# dspace_angular_task_def_arn = "arn:aws:ecs:us-east-1:123456789012:task-definition/dspace-angular:1"
# dspace_api_task_def_arn     = "arn:aws:ecs:us-east-1:123456789012:task-definition/dspace-api:1"
# dspace_jobs_task_def_arn    = "arn:aws:ecs:us-east-1:123456789012:task-definition/dspace-jobs:1"
